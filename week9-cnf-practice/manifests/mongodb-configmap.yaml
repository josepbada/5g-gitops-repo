apiVersion: v1
kind: ConfigMap
metadata:
  name: mongodb-config
  namespace: telco-core
  labels:
    app: mongodb
    component: database
    tier: data-layer
data:
  mongo.conf: |
    # MongoDB configuration for 5G Core session state management
    storage:
      dbPath: /data/db
      journal:
        enabled: true
    systemLog:
      destination: file
      path: /var/log/mongodb/mongod.log
      logAppend: true
    net:
      port: 27017
      bindIp: 0.0.0.0
    replication:
      replSetName: rs0
  init-script.js: |
    // Initialize databases for 5G Core Network Functions
    db = db.getSiblingDB('open5gs');
    db.createCollection('subscribers');
    db.createCollection('sessions');
    db.createCollection('smf_context');
    db.createCollection('amf_context');
    
    // Create indexes for performance
    db.subscribers.createIndex({ "imsi": 1 }, { unique: true });
    db.sessions.createIndex({ "pdu_session_id": 1 });
    db.smf_context.createIndex({ "supi": 1 });
    db.amf_context.createIndex({ "supi": 1 });
    
    print('5G Core databases initialized successfully');